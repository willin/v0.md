---
title: ä» 0 åˆ° 1 æ­å»ºä¸€ä¸ª Astro åšå®¢
description: é›†æˆ Tailwind CSSã€i18nã€MDXã€RSSã€è¯„è®ºç³»ç»Ÿç­‰
published: 2024-09-01
category: å¼€å‘ç¬”è®°
tags:
  - Astro
  - Tailwind CSS
  - i18n
  - MDX
---

export const refs = [
  {
    site: 'https://innei.in/',
    repo: 'https://github.com/Innei/Shiro'
  },
  {
    site: 'https://fuwari.vercel.app/',
    repo: 'https://github.com/saicaca/fuwari'
  },
  {
    site: 'https://yfi.moe',
    repo: 'https://github.com/yy4382/yfi.moe'
  },
  {
    site: 'https://kai.bi/',
    repo: 'https://github.com/ccbikai/astro-aria'
  }
];

## ç›®å½•åŠå½“å‰è¿›å±•

- [x] åˆå§‹åŒ–é¡¹ç›®åŠé…ç½®
  - [x] Linter åŠåŸºæœ¬é…ç½®
  - [x] é™æ€åŒ–ç½‘ç«™è¾“å‡º
  - [x] æ·»åŠ å®˜æ–¹é›†æˆ
  - [x] åˆ›å»ºç¬¬ä¸€ä¸ª Layout
- [x] i18n å›½é™…åŒ–æ”¯æŒ
  - [x] å®‰è£…é…ç½®
  - [x] ç¿»è¯‘æ–‡æœ¬ç¤ºä¾‹
- [ ] åŸºç¡€å¸ƒå±€ã€æ ·å¼ã€åŠ¨ç”»
  - [x] é¡µé¢åˆ‡æ¢åŠ¨ç”»é…ç½®
  - [x] è¯­è¨€åˆ‡æ¢ç»„ä»¶
  - [x] ä¸»é¢˜ Dark æ¨¡å¼ç»„ä»¶
  - [ ] Search ç»„ä»¶
- [ ] æ–‡ç«  Collection
  - [ ] MDX å†…å®¹å¢å¼º
  - [ ] TOCã€é˜…è¯»è¿›åº¦
  - [ ] å­—æ•°ã€é˜…è¯»æ—¶é—´
  - [ ] Github å¡ç‰‡
  - [ ] ä»£ç é«˜äº®
- [ ] RSS
- [ ] è¯„è®ºç³»ç»Ÿ
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] è‹±è¯­åˆ‡æ¢æç¤º
- [ ] ç»Ÿè®¡åˆ†æã€å¹¿å‘Š

## å–œæ¬¢çš„å‡ ä¸ªç½‘ç«™å‚è€ƒ

<ul>
  {refs.map((item) => (
    <li>
      <a href={item.site} rel="nofollow">{item.site}</a> | Repo: &nbsp;
      <a href={item.repo} rel="nofollow">{item.repo}</a>
    </li>
  ))}
</ul>

## åˆå§‹åŒ–é¡¹ç›®åŠé…ç½®

åˆ›å»ºä¸€ä¸ªç©ºç™½é¡¹ç›®å¼€å§‹ï¼š

```bash
# å¯ä»¥ç”¨å…¶ä»– package manager è¿›è¡Œåˆ›å»º
â¯ bun create astro@latest

 astro   Launch sequence initiated.

   dir   Where should we create your new project?
         ./v0.md

  tmpl   How would you like to start your new project?
         Empty

    ts   Do you plan to write TypeScript?
         Yes

   use   How strict should TypeScript be?
         Strict

  deps   Install dependencies?
         No
      â—¼  No problem! Remember to install dependencies after setup.

   git   Initialize a new git repository?
         Yes

      âœ”  Project initialized!
         â–  Template copied
         â–  TypeScript customized
         â–  Git initialized

  next   Liftoff confirmed. Explore your project!

         Enter your project directory using cd ./v0.md
         Run bun run dev to start the dev server. CTRL+C to stop.
         Add frameworks like react or tailwind using astro add.

         Stuck? Join us at https://astro.build/chat

â•­â”€â”€â”€â”€â”€â•®  Houston:
â”‚ â—  â—¡ â—   Good luck out there, astronaut! ğŸš€
â•°â”€â”€â”€â”€â”€â•¯
```

### Linter åŠåŸºæœ¬é…ç½®

- åˆ›å»º `.editorconfig`
- å®‰è£… Linter
```bash
bun add -D @biomejs/biome @willin/biome-config
```
- åˆ›å»º `biome.json` Linter é…ç½®æ–‡ä»¶
```json
{
  "$schema": "https://biomejs.dev/schemas/1.8.3/schema.json",
  "extends": ["@willin/biome-config"],
  "overrides": [
    {
      "include": ["*.svelte", "*.astro", "*.vue"],
      "linter": {
        "rules": {
          "style": {
            "useConst": "warn",
            "useImportType": "warn"
          }
        }
      }
    }
  ]
}
```
- æ·»åŠ  `pre commit` æ ¡éªŒ
```bash
bun add -D husky lint-staged
# åˆ›å»ºé’©å­
npx husky
```

### é™æ€åŒ–ç½‘ç«™è¾“å‡º

éƒ¨ç½²ä¸ºé™æ€é¡µé¢ï¼Œå¹¶è¿›è¡Œä¸Šé“¾ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦é…ç½®è¾“å‡ºä¸º `static`ï¼š

```ts
// astro.config.ts
import { defineConfig } from "astro/config";

// https://astro.build/config
export default defineConfig({
	site: "https://v0.md",
	output: "static",
	build: {
		format: "directory"
	}
});
```

### æ·»åŠ å®˜æ–¹é›†æˆ

```bash
bunx astro add tailwind
bunx astro add mdx
bunx astro add sitemap
```

### åˆ›å»ºç¬¬ä¸€ä¸ª Layout

åˆ›å»ºä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ã€‚

`src/styles/global.css`ï¼š

```css
/* src/styles/global.css */
@tailwind base;
@tailwind components;
@tailwind utilities;
```

`src/layout/BaseLayout.astro`ï¼š

```astro
---
import '../styles/global.css';
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
	</head>
	<body>
		<slot />
	</body>
</html>
```

çœ‹çœ‹æ•ˆæœï¼š

```bash
bun dev
```

ç„¶åè®¿é—®ï¼š http://localhost:4321

## i18n å›½é™…åŒ–æ”¯æŒ

- ~~ä½¿ç”¨ `astro-i18n-aut` å®ç° i18n~~
- æ‰‹æ“ä¸€ä¸ª

### å®‰è£…é…ç½®

```bash
bun add dlv templite
bun add -D @types/dlv
```

å®ç° Message ç¿»è¯‘å…¶å®å¾ˆç®€å•ï¼Œå…¶ä¸­å‚è€ƒäº†æˆ‘åœ¨ [Remix i18n](https://github.com/willin/remix-i18n/blob/main/src/i18n.ts) çš„å®ç°ï¼š

```ts
import dlv from 'dlv';
import tmpl, { type Values } from 'templite';
import { defaultLocale, locales } from '../consts';
import en from './en.json';
import zh from './zh.json';

const messages = {
  zh,
  en
};

const langs = Object.keys(locales);

export const i18n =
  (url: URL) =>
  (key: string, params: Values = {}): string => {
    const lang = getLocaleFromUrl(url);
    const val = dlv(messages?.[lang as keyof typeof locales], key, '');
    if (typeof val === 'function') return val(params);
    if (typeof val === 'string') return tmpl(val, params);
    return val;
  };

export function getLocaleFromUrl(url: URL): string {
  const parts = url.pathname.split('/').filter((el) => el !== '');
  let match = '';
  for (const part of parts) {
    if (langs.includes(part)) match = part;
  }
  if (match) return match;
  return defaultLocale;
}
```


### ç¿»è¯‘æ–‡æœ¬ç¤ºä¾‹

```astro
---
import { i18n } from '@/i18n';

const t = i18n(Astro.url);
---

<main>
  <h1>
    ğŸ§‘â€ğŸš€ {t('title')}
  </h1>
</main>
// ...
```


## åŸºç¡€å¸ƒå±€ã€æ ·å¼ã€åŠ¨ç”»

### é¡µé¢åˆ‡æ¢åŠ¨ç”»é…ç½®

ç”¨åˆ°äº† Astro è‡ªå¸¦çš„ `ViewTransitions` å’Œ `astro-loading-indicator` ï¼ˆåŠ è½½è¿›åº¦æ¡ï¼‰ç»„ä»¶ã€‚å¯ä»¥æ’å…¥åˆ° `BaseLayout` çš„ `head` ä¸­ã€‚

```astro
---
import { ViewTransitions } from 'astro:transitions';
import LoadingIndicator from 'astro-loading-indicator/component';
---

<head>
  <ViewTransitions fallback="swap" />
  <LoadingIndicator color="#f06" />
</head>

// ...
```

### è¯­è¨€åˆ‡æ¢ç»„ä»¶

ä¸ºè¯­è¨€åˆ‡æ¢ç»„ä»¶å†™äº†å‡ ä¸ªå·¥å…·ç±»ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š

```ts

const langs = Object.keys(locales);
/**
 * Get Locale from URL
 * @param url
 * @returns zh | en
 */
export function getLocaleFromUrl(url: URL | string): string {
  const parts = (typeof url === 'string' ? url : url.pathname)
    .split('/')
    .filter((el) => el !== '');
  let match = '';
  for (const part of parts) {
    if (langs.includes(part)) match = part;
  }
  if (match) return match;
  return defaultLocale;
}

/**
 * Get Relative URL without Locale
 * @param url sth like: /zh/about/
 * @returns /about/
 */
export function getRelativeUrlWithoutLocale(url: URL | string): string {
  const parts = (typeof url === 'string' ? url : url.pathname)
    .split('/')
    .filter((el) => el !== '');
  const newParts = parts.filter((el) => !langs.includes(el));
  const u = `/${newParts.join('/')}`;
  return u.endsWith('/') ? u : `${u}/`;
}

/**
 * Get Locale URL
 * @param url /about/
 * @param locale zh | en
 * @returns /en/about/
 */
export function getLocaleUrl(
  url: URL | string,
  locale: keyof typeof locales
): string {
  const u = getRelativeUrlWithoutLocale(url);
  return locale === defaultLocale ? u : `/${locale}${u}`;
}
```

ç„¶ååˆ›å»ºäº†ä¸€ä¸ª `LocleLink` ç»„ä»¶ï¼š

```astro
---
import { defaultLocale, type locales } from '@/consts';
import { getLocaleFromUrl, getLocaleUrl, i18n } from '@/i18n';

type Props = {
  href: string;
  className?: string;
  locale?: keyof typeof locales;
};

const { href, className, locale } = Astro.props;

const currentLocale = locale || getLocaleFromUrl(Astro.url);
const link = getLocaleUrl(href, currentLocale);
---

<a href={link} class:list={[className]}>
  <slot />
</a>
// ...
```

åˆ‡æ¢è¯­è¨€çš„æ—¶å€™ï¼Œä¸‹æ‹‰èœå•ä¸­åŠ å…¥ `LoacleLink`ï¼š

```astro
---
import { languages } from '@/consts';
import { getLocaleFromUrl } from '@/i18n';
import { Icon } from 'astro-icon/components';
import Dropdown from '../ui/Dropdown.astro';
import LocaleLink from '../ui/LocaleLink.astro';

const url = Astro.url;
const locale = getLocaleFromUrl(Astro.url);
---

<Dropdown className="w-32">
  <Icon name="i18n" class="size-5" />
  <ul slot="dropdown">
    {Object.entries(languages).map(([code,{name, flag, unicode}]) => (
      <li>
        <LocaleLink href={url} locale={code} className={locale === code ? 'active flex' : 'flex'}>
          <img
            loading="lazy"
            width="20"
            height="20"
            alt={flag}
            src={`https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/${unicode}.svg`}
          />
          <span class="flex flex-1 justify-between pl-2">{name}</span>
        </LocaleLink>
      </li>
    ))}
  </ul>
</Dropdown>
// ...
```

### ä¸»é¢˜ Dark æ¨¡å¼ç»„ä»¶

ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†åŠŸèƒ½ï¼š

- åˆ‡æ¢æ˜æš—ä¸»é¢˜ï¼š `light`ã€`dark`ã€`auto` ä¸‰ç§æ¨¡å¼
- è°ƒæ•´ä¸»é¢˜è‰²è°ƒï¼š `hue` 0 - 360

```ts
function getHue() {
  return +localStorage.getItem('hue') || primaryHue;
}
function setHue(hue) {
  localStorage.setItem('hue', hue);
  document.documentElement.style.setProperty('--primary-hue', hue);
}

function loadDarkMode() {
  let darkMode = localStorage.getItem("theme");
  if (darkMode === null) {
    localStorage.setItem("theme", "auto");
    darkMode = "auto";
  }
  if (darkMode === "light" || darkMode === "auto") {
    document.documentElement.classList.remove("dark");
  }
  if (darkMode === "dark") {
    document.documentElement.classList.add("dark");
  }
  if (
    darkMode === "auto" &&
    window.matchMedia("(prefers-color-scheme: dark)").matches
  ) {
    document.documentElement.classList.add("dark");
  }
}

function dispatchClick() {
  const darkMode = localStorage.getItem("theme");
  const buttons = document.querySelectorAll('button.theme-button');

  buttons.forEach((button) => {
    if (button.dataset.id === darkMode) {
      button.classList.add('active');
      document.querySelector('span.current-theme')?.setHTMLUnsafe(button.querySelector('span').innerHTML);
    } else {
      button.classList.remove('active');
    }
    const click = () => {
      localStorage.setItem('theme', button.dataset.id);
      buttons.forEach((b)=> b.classList.remove('active'));
      button.classList.add('active');
      document.querySelector('span.current-theme')?.setHTMLUnsafe(button.innerText);
      loadDarkMode();
    };
    button.removeEventListener('click', click);
    button.addEventListener('click', click);
  });
}

function init() {
  setHue(getHue());
  loadDarkMode();
  dispatchClick();
}
init();
document.addEventListener("astro:after-swap", init);
```

è®¾ç½®é¡µé¢çš„ä¸»è‰²è°ƒï¼ˆé€šè¿‡ `hue` è°ƒèŠ‚ï¼‰ï¼š

- ä¸»å­—ä½“é¢œè‰²
- ä¸»èƒŒæ™¯é¢œè‰²
- æ¬¡å­—ä½“é¢œè‰²
- æ¬¡èƒŒæ™¯è‰²


### Search ç»„ä»¶ï¼ˆé™æ ·å¼ï¼‰

## æ–‡ç«  Collection

## MDX å†…å®¹å¢å¼º

### TOCã€é˜…è¯»è¿›åº¦

### å­—æ•°ã€é˜…è¯»æ—¶é—´

### Github å¡ç‰‡

### ä»£ç é«˜äº®

## RSS

## è¯„è®ºç³»ç»Ÿ

## æ€§èƒ½ä¼˜åŒ–

## è‹±è¯­åˆ‡æ¢æç¤º

## ç»Ÿè®¡åˆ†æã€å¹¿å‘Š


