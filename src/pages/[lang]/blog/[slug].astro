---
// Duplicated pages are not supported in Astro yet, so we need to use a workaround
import { SITE_TITLE } from '@/consts';
import { SITE_DESCRIPTION } from '@/consts';
import { getLocaleFromUrl, getRelativeUrlWithoutLocale } from '@/i18n';
import { i18n } from '@/i18n';
import SidebarLayout from '@/layout/SidebarLayout.astro';
import { CollectionType, getLocaleCollection } from '@/lib/collection';
import { getSeo } from '@/lib/seo';
import { SEO } from 'astro-seo';

export async function getStaticPaths() {
  const posts = await getLocaleCollection('', CollectionType.Posts, '');
  return posts.map((post) => {
    return {
      params: {
        lang: getLocaleFromUrl(post.slug),
        slug: getRelativeUrlWithoutLocale(post.slug)
      },
      props: { entry: post }
    };
  });
}
const { entry } = Astro.props;

const { Content } = await entry.render();

const t = i18n(Astro.url);
const seoConfig = getSeo({
  title: entry.data.title,
  description: entry.data.description || SITE_DESCRIPTION
});
---

<SidebarLayout>
  <SEO {...seoConfig} titleTemplate={`%s - ${SITE_TITLE}`} canonical={new URL(Astro.url.pathname, Astro.site)} slot="seo" />
  <main class="bg-card shape-card p-6 sm:p-8 main-card-onload rounded-card">
    <article class="prose w-full max-w-full dark:prose-invert">
      <header class="relative py-10">
        <h1 class="post-header" data-first-letter={entry.data.title[0]}>
          {entry.data.title}
        </h1>
      </header>

      <Content />
    </article>
  </main>
</SidebarLayout>

